<blueprint>

    <sensor node="entryField" on="keydown" filter="isEscape" pipe="cmd_Cancel" />
    <sensor node="entryField" on="keydown" filter="isEnter" pipe="cmd_Submit" />
    <sensor node="entryField" on="blur" adapt="read editing" filter="isTrue" pipe="cmd_Submit" />

    <sensor need="item,editing" run="render" />

    <sensor watch="cmd_Submit,cmd_Cancel" transform="bool false" pipe="editing" />

    <sensor node="editHolder" on="selectstart" run="prevent" />
    <command name="cmd_Submit" filter="hasText" transform="read item" pipe="cmd_Update" />
    <command name="cmd_Submit" filter="isEmpty" transform="read item" pipe="cmd_DestroyTodo" />
    <command name="cmd_Cancel" pipe="cmd_Refresh" />
    <command name="cmd_Update" transform="updateText" pipe="cmd_Refresh" />

</blueprint>


<display>

    <div id="editHolder" style="display: flex; color: rgb(14, 177, 162);">
        <div style="width: 55px; height: 58px; position: relative; ">
            <span class="fa fa-pencil" style="font-size: 32px; left: 10px; top: 14px; position: absolute;"></span>
        </div>
        <input id="entryField" style="width: 100%; font-family: inherit;padding: 12px 16px 11px 12px;font-size: 24px;color: rgb(14, 177, 162);line-height: 1.4em;
    outline: none;background: #1F211E;box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.7);border: 1px solid rgba(0,0,0,.7);" value=""  />
    </div>

</display>


<script>

    $.cog({


        render: function(msg){
            entryField = this.entryField;
            entryField.val(msg.item.text);
            setTimeout(function(){ entryField && entryField.focus();}, 0);
        },

        ENTER_KEY: 13,
        ESCAPE_KEY: 27,

        isTrue: function(msg){
            return msg;
        },

        isEnter: function(ev){
            return ev.which === this.ENTER_KEY;
        },

        isEscape: function(ev){
            return ev.which === this.ESCAPE_KEY;
        },

        trimText: function(){
            return this.entryField.val().trim();
        },

        hasText: function(){
            return this.trimText().length > 0;
        },

        isEmpty: function(){
            return !this.hasText();
        },

        updateText: function(msg){
            msg.text = this.trimText();
            return msg;
        }

    });

</script>